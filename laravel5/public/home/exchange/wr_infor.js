var tool={init:function(){var _this=this;$(function(){var needAdd=$("#needAdd");_this.addAddr(needAdd);_this.changeAddr();_this.contJifen();})},contJifen:function(){var self=this;var confirmList=$(".confirm_list");confirmList.find("li").each(function(i,n){if(i==0)return;var baNum=$(n).find(".baNum");self.initJifen(baNum,$(n));self.addNum($(n));});},addNum:function(r){var self=this;var contrlNum=r;var plus=contrlNum.find(".plus");var min=contrlNum.find(".min");var baNum=contrlNum.find(".baNum");var s_data=contrlNum.find(".contrl_num");var contrlNum_val=parseInt(s_data.attr("data"));plus.click(function(){if(contrlNum_val){if(parseInt(baNum.val())<contrlNum_val){min.css("cursor","pointer");baNum.val(parseInt(baNum.val())+1);self.initJifen(baNum,contrlNum);if(parseInt(baNum.val())==contrlNum_val){plus.css("cursor","not-allowed");}}
else{self.isBigger(baNum.val(),contrlNum_val,baNum);}}else{baNum.val(parseInt(baNum.val())+1);self.initJifen(baNum,contrlNum);}});min.click(function(){if(parseInt(baNum.val())>1){plus.css("cursor","pointer");baNum.val(parseInt(baNum.val())-1);self.isBigger(baNum.val(),contrlNum_val,baNum);self.initJifen(baNum,contrlNum);if((baNum.val()==1)){min.css("cursor","not-allowed");}}});baNum.keyup(function(){if(!parseInt(baNum.val())){baNum.val(1);self.initJifen(baNum,contrlNum);}
if(contrlNum_val&&baNum.val()>contrlNum_val){self.isBigger(baNum.val(),contrlNum_val,baNum);baNum.val(contrlNum_val);self.initJifen(baNum,contrlNum);};if(baNum.val()){baNum.val(baNum.val().replace(/^0*/,''));}});},isBigger:function(r,t,hand){var self=this;if(parseInt(r)>=parseInt(t)){self.showErr("牛大头数量"+t+"，购买页面输入数量应不能大于"+t);hand.val(t);}},initJifen:function(r,t){if(r.length&&t.length){var items_dan=parseInt(r.val());var jf_num=t.find(".cl_2").attr("data-jifen")?t.find(".cl_2").attr("data-jifen"):1;var clColr=t.find(".cl_colr");clColr.html(jf_num*items_dan+"牛大头");}},showErr:function(r){var placeError=$("#placeError");placeError.html(r).show();setTimeout(function(){placeError.fadeOut(function(){placeError.html("");});},5000);},addAddr:function(t){var th_el=t;th_el.bind("click",function(){$.layer({type:1,title:'新增地址',shadeClose:true,area:['460px','400px'],page:{html:$("#huoAddr").html()}});})},changeAddr:function(){var self=this;var addrList=$(".addr_list li");addrList.each(function(i,n){$(n).bind("click",function(){$(n).siblings().removeClass("current").end().addClass("current");});$(n).find(".addr_rewrite").click(function(){var _this=$(this);var _index=_this.attr("data");var data=addrDetail[_index];var _html=self.addrTem(data);$.layer({type:1,title:'保存地址',shadeClose:true,area:['460px','400px'],page:{html:_html}});});});},addrTem:function(data){return _.template($("#addrTem").html(),data);}};tool.init();