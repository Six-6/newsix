(function(){var FloatNav=function(selector,config){this.$container=$(selector);this.criticalWidth=config.criticalWidth;this.criticalHeight=config.criticalHeight;this.lefttobody=config.lefttobody;this.listShowed=false;this.animated=true;this.hanged=undefined;this.init();};var getAnchor=function(node){return node.href.substr(node.href.indexOf('#'));};_.extend(FloatNav.prototype,{init:function(){var _this;_this=this;this.listenedNodes=_.map(this.$container.find('.floatnavlink'),function(linknode){var id=getAnchor(linknode).substr(1);return document.getElementById(id);});this.centerY();this.width=this.getWidth();this.checkCriticalWidth();this.checkScrollTop();this.bindEvents();this.mCustomScrollbar();this.menuFollowingScrollPosition();},getWidth:function(){var width,$container;$container=this.$container;$container.children('.floatnav-list').removeClass('floatnavhidden');width=$container.outerWidth();$container.children('.floatnav-list').addClass('floatnavhidden');return width;},bindEvents:function(){var _this,$container;_this=this;$container=this.$container;$(window).on('resize',function(){_this.centerY();_this.checkCriticalWidth();}).on('scroll',_.debounce(function(){_this.checkScrollTop();},100));$container.find('.floatnavlink').on('click',function(e){var selector,top;e.preventDefault();selector=getAnchor(this);top=$(selector).offset().top;$('html, body').animate({scrollTop:top});});$container.find('.floatnavtotoplink').on('click',function(e){e.preventDefault();$('html, body').animate({scrollTop:0});});$container.mouseleave(function(){_this.animated&&(_this.hanged===false)&&_this.shrink();}).mouseenter(function(){_this.animated&&(_this.hanged===false)&&_this.cling();});},mCustomScrollbar:function(){this.$container.find('.floatnav-sublist').each(function(i,sublist){var $sublist=$(this);if($sublist.find('.floatnav-sublist-item').length>10){$sublist.mCustomScrollbar({theme:"dark",scrollInertia:200});}});},menuFollowingScrollPosition:function(){var following,_this;_this=this;following=function(){var matchNode,listenedNodes,possibleMatchNode,rect;listenedNodes=_.filter(_this.listenedNodes,function(currentNode,i){return currentNode.getBoundingClientRect().top<=20;});listenedNodes.sort(function(a,b){return b.getBoundingClientRect().top-a.getBoundingClientRect().top;});possibleMatchNode=listenedNodes[0];if(possibleMatchNode){rect=possibleMatchNode.getBoundingClientRect();if(rect.bottom>0){_this.highlightMenu(possibleMatchNode.getAttribute('id'));}else{_this.unHighlightMenu();}}else{_this.unHighlightMenu();}};$(window).on('scroll',_.debounce(following,100));},highlightMenu:function(id){var anchor,$floatnavlinks,currentFloatnavlink,$currentFloatnavlink,$sublist;anchor='#'+id;$floatnavlinks=this.$container.find('.floatnavlink');currentFloatnavlink=_.filter($floatnavlinks,function(linknode){return getAnchor(linknode)===anchor;});this.$currentFloatnavlink&&this.$currentFloatnavlink.removeClass('highlight');this.$currentFloatnavlink=$currentFloatnavlink=$(currentFloatnavlink);$currentFloatnavlink.addClass('highlight');$sublist=$currentFloatnavlink.parents('.floatnav-sublist');this.collapse();if($sublist.length){$sublist.removeClass('none');if($sublist.hasClass('mCustomScrollbar')){$sublist.mCustomScrollbar('scrollTo',$currentFloatnavlink);}}else{$sublist=$currentFloatnavlink.parent('.floatnav-list-item').children('.floatnav-sublist');$sublist.removeClass('none');}
this.centerY();},unHighlightMenu:function(){var $currentFloatnavlink,$sublist;$currentFloatnavlink=this.$currentFloatnavlink;if($currentFloatnavlink){$currentFloatnavlink.removeClass('highlight');$sublist=$currentFloatnavlink.parents('.floatnav-sublist');if($sublist.length){$sublist.addClass('none');this.centerY();}}},collapse:function(){this.$container.find('.floatnav-sublist').addClass('none');this.centerY();},checkScrollTop:function(){if($(window).scrollTop()>=this.criticalHeight){this.fadeIn();}else{this.fadeOut();}},checkCriticalWidth:function(){if($(window).width()>=this.criticalWidth+this.width*2){this.showList(($(window).width()-this.criticalWidth)/2);}else{this.showBtn();}},showList:function(padding_x){var $container,left;$container=this.$container;left=padding_x-this.width-this.lefttobody;this.hanged=true;if(!this.listShowed){$container.children('.floatnav-toexpandbtn').addClass('none');$container.children('.floatnav-list').removeClass('floatnavhidden');this.listShowed=true;}
$container.css('left',Math.max(0,left));},showBtn:function(){this.hanged=false;if(this.listShowed){this.shrink();}else{this.$container.children('.floatnav-toexpandbtn').removeClass('none');}},cling:function(){var _this=this;this.$container.animate({'left':-this.$container.outerWidth()},'fast','easeOutCubic',function(){$(this).children('.floatnav-toexpandbtn').addClass('none');$(this).children('.floatnav-list').removeClass('floatnavhidden');_this.listShowed=true;_this.centerY();_this.animated=false;$(this).animate({'left':0},'fast',function(){_this.animated=true;});});},shrink:function(){var _this=this;this.$container.animate({'left':-this.$container.outerWidth()},'fast','easeOutCubic',function(){$(this).children('.floatnav-list').addClass('floatnavhidden');_this.listShowed=false;$(this).children('.floatnav-toexpandbtn').removeClass('none');_this.centerY();_this.animated=false;$(this).animate({'left':0},'fast',function(){_this.animated=true;});});},centerY:function(){var win_w,win_h,h,top,$container;win_w=$(window).width();win_h=$(window).height();$container=this.$container;if($container.is(':hidden')){$container.removeClass('none');h=$container.outerHeight();$container.addClass('none');}else{h=$container.outerHeight();}
top=Math.max(0,(win_h-h)/2);$container.css({top:top+'px'});},fadeIn:function(){this.$container.stop().removeClass('none').animate({opacity:1},'fast','easeOutCubic');},fadeOut:function(){this.$container.stop().animate({opacity:0},'fast','easeOutCubic',function(){$(this).addClass('none');$(this).css({opacity:1});});}});$.fn.floatnav=function(config){if($.browser.msie&&($.browser.version==6||$.browser.version==7)){return false;}
$(this).each(function(){new FloatNav(this,config);});};})();