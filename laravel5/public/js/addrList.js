function AddrList(){this.track=null;this.china=[];this.foreign=[];this.chinaWrap=null;this.foreignWrap=null;this.init();}
AddrList.prototype=new Events();$.extend(AddrList.prototype,{init:function(){var mapWrap=$('#J_Map');var chinaWrap=$('#J_China');var foreignWrap=$('#J_Foreign');var switchBtn=$('#J_MapSwitch');var innerList=$('#J_InnerList');var outerList=$('#J_OuterList');var trackWrap=$('#J_TrackWrap');var chinaContent=$('#chinaEare').find('p:eq(0)');var foreignContent=$('#foreignEare').find('p:eq(0)');if(typeof google!="undefined"){var chinaCenter=new google.maps.LatLng(34.2593803,108.9672088);var globalCenter=new google.maps.LatLng(38.963802,59.5775989);var mapProp={center:globalCenter,zoom:2,minZoom:2,maxZoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:false,panControl:false,mapTypeControl:false,rotateControl:false,streetViewControl:false};var map=new google.maps.Map(mapWrap[0],mapProp);google.maps.event.addListener(map,'zoom_changed',function(){});}else{$(".tuc-map").hide();}
switchBtn.click(function(){if(typeof google!="undefined"){if(switchBtn.hasClass('map-global')){switchBtn.removeClass('map-global').addClass('map-china');map.setZoom(5);map.setCenter(chinaCenter);}else{switchBtn.addClass('map-global').removeClass('map-china');map.setZoom(2);map.setCenter(globalCenter);}}});switchBtn.addClass('map-global').removeClass('map-china');if(typeof google!="undefined"){map.setZoom(2);map.setCenter(globalCenter);this.map=map;}
this.chinaWrap=chinaWrap;this.foreignWrap=foreignWrap;this.innerList=innerList;this.outerlist=outerList;this.trackWrap=trackWrap;this.chinaContent=chinaContent;this.foreignContent=foreignContent;},loadAddr:function(){var self=this;dataService.getAddrs(function(list){if(list.china.length>0||list.foreign.length>0){var hash=window.location.hash;self.buildAddrs(list);if(hash){$('body,html').scrollTop($(hash).offset().top);}}else{self.chinaContent.hide();self.foreignContent.hide();self.chinaWrap.hide();self.foreignWrap.hide();self.trackWrap.append($('#T-Blank').html());}});},buildAddrs:function(list){var self=this;var china=self.china;var foreign=self.foreign;var chinaWrap=self.chinaWrap;var foreignWrap=self.foreignWrap;var map=self.map;$.each(list.china,function(index,item){var area=new Area(item,map,true);china.push(area);if(window.isIndex){if(!area.isEmpty()){chinaWrap.append(area.getEle());}}else{chinaWrap.append(area.getEle());}
area.bind('add',function(){self.trigger('add');});area.bind('remove',function(){if(this.isEmpty()){self.removeAddr('china',this.id);}
self.trigger('remove');});});self.chinaWrap.show();this.updateInnerProvince();$.each(list.foreign,function(index,item){var area=new Area(item,map,false);foreign.push(area);if(window.isIndex){if(!area.isEmpty()){foreignWrap.append(area.getEle());}}else{foreignWrap.append(area.getEle());}
area.bind('add',function(){self.trigger('add');});area.bind('remove',function(){if(this.isEmpty()){self.removeAddr('foreign',this.id);}
self.trigger('remove');});});self.foreignWrap.show();this.updateOuterCountry();},getAddrIndex:function(type,id){var list=this[type];for(var i=0;i<list.length;i++){if(list[i].id==id){return i;}}
return-1;},removeAddr:function(type,id){var self=this;var index=self.getAddrIndex(type,id);var addrs=self[type];var item;if(index!==-1){item=addrs[index];addrs.splice(index,1);self.trigger('remove');}},addArea:function(data){var self=this;var type=data.type;var index=this.getAddrIndex(type,data.id);var area;if(index===-1){area=new Area(data,this.map,data.type==='china');this[type].push(area);if(type==='china'){this.chinaWrap.append(area.getEle());this.updateInnerProvince();}else if(type==='foreign'){this.foreignWrap.append(area.getEle());this.updateOuterCountry();}
area.bind('add',function(){self.trigger('add');});area.bind('remove',function(){if(this.isEmpty()){self.removeAddr(data.type,this.id);}
self.trigger('remove');});self.trigger('add');}else{area=this[type][index];if(data.list){area.addAddrs(data.list);}}},addAreas:function(data){for(var key in data){if(data.hasOwnProperty(key)){this.addArea({id:key,x:74,y:80});}}},addAnchorToMap:function(anchor){anchor.setMap(this.map);},updateInnerProvince:function(){var provinces=this.china;var html='';$.each(provinces,function(index,province){var data=province.getData();if(window.isIndex){html+='<a class="track-city" title="'+data.name+'" href="'+footprint_url+'#china'+data.id+'">'+data.name+'</a>';}else{html+='<a class="track-city" title="'+data.name+'" href="#china'+data.id+'">'+data.name+'</a>';}});this.innerList.html(html);},updateOuterCountry:function(){var countries=this.foreign;var html='';$.each(countries,function(index,country){$.each(country.children,function(index,addr){var data=addr.getData();if(window.isIndex){html+='<a class="track-city" title="'+data.name+'" href="'+footprint_url+'#foreignCity'+data.id+'">'+data.name+'</a>';}else{html+='<a class="track-city" title="'+data.name+'" href="#foreignCity'+data.id+'">'+data.name+'</a>';}});});this.outerlist.html(html);}});