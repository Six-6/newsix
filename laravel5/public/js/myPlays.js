$(function(){$('#J_qa_nav a').click(function(event){var index=$(this).index();$('#J_qa_nav a').removeClass('click').eq(index).addClass('click');});$('a.link_share').on('mouseenter',function(){if($(this).next().hasClass('shareulbg_2')){$(this).next().show();}});$.each($('a.link_share'),function(i,n){if($(n).next().hasClass('shareulbg_2')){$(n).on('mouseenter',function(){$(this).next().show();});$(n).parent().on('mouseleave',function(){$(n).next().hide();});$(n).next().on('mouseleave',function(){$(this).hide();});}});if($('.my_way_0').eq(0).attr('data-isme')==1){var dataIsme=1;var draftUrl="/yii.php?r=person/personpage/draftWayList";}else{var dataIsme=2;}
var wayUrl="/yii.php?r=person/personpage/wayList";var collectionUrl="/yii.php?r=person/personpage/collectionWayList";getDataList($('.my_way_0').eq(0).children('tbody'),1,dataIsme,wayUrl);getDataList($('.my_way_1').eq(0).children('tbody'),2,dataIsme,collectionUrl);$('.waynote_tab').children('.tab').on('click',function(){if($(this).hasClass('cur'))return;$(this).siblings().removeClass('cur');$(this).addClass('cur');$(this).parents('.dyj_left_block').find('.datatable').hide();var table=$(this).parents('.dyj_left_block').find('.my_way_'+$(this).index());table.show();$('.pagination').hide();$('.pagination').eq($(this).index()).show();});$('.my_way_0').eq(0).delegate('tbody .a_del','click',function(){var a_del=$(this);var tid=a_del.attr('data-tid');if(tid==undefined){if(console){console.log('data-tid is undefined');}
return;}
var tr=$(this).parents('tr');var strHtml='<div style="padding: 10px 20px; font-size: 14px; font-family: Microsoft Yahei;">'+'确认删除玩法?'+'</div>';var option={type:1,title:['提示'],closeBtn:[0,true],btns:2,btn:['确定','取消'],area:['310','180'],success:function(layerHtml){layerHtml.find('.xubox_botton a').css({bottom:'20px'});layerHtml.find('.xubox_setwin').css({top:'10px'});layerHtml.find('.xubox_title em').css({'line-height':'34px'})},yes:function(index){$.ajax({url:'/yii.php?r=person/personpage/delWay',type:'post',dataType:'json',data:{id:tid},success:function(response,status,xhr){if(response.success){$(".pagination").eq(0).replaceWith('<div class="pagination"></div>');getDataList($('.my_way_0').eq(0).children('tbody'),1,dataIsme,wayUrl);}},error:function(xhr){alert('删除玩法失败.');}});layer.close(index);console.log('delete trips');},no:function(index){layer.close(index);},page:{html:strHtml}};$.layer(option);});$(".my_way_1").eq(0).delegate(".a_collect","click",function(){var contentId=$(this).attr("data-tid");var self=$(this);console.log(contentId);$.ajax({url:"/yii.php?r=person/personpage/doCollect",type:'POST',dataType:'json',data:{content_id:contentId,page_uid:window.page_uid},success:function(resp){console.log(resp);if(resp.success){$(".pagination").eq(1).replaceWith('<div class="pagination" ></div>');getDataList($('.my_way_1').eq(0).children('tbody'),2,dataIsme,collectionUrl);}},error:function(){console.log('error');}})})
var count=0;function getDataList(_tbody,_type,_isme,ajaxUrl){console.log(_type);var _data={type:_type,page:1}
if(typeof unique_code_flag!="undefined"&&unique_code_flag){_data.page_user_unique_code=window.page_user_unique_code}else{_data.page_uid=window.page_uid;}
$.ajax({url:ajaxUrl,type:'POST',data:_data,dataType:'json',success:function(response,status,xhr){var listObj={wayObj:response};listObj.wayObj.isme=_isme;listObj.wayObj.type=_type;var strHtml=template('T_wayList',listObj);_tbody.html(strHtml);if(response.pagecount!=0){console.log(ajaxUrl);var pagenum=response.pagecount
$(".waynote_tab").siblings('.pagination').eq(_type-1).initPager({totalPage:pagenum,showPage:6,ajax:function(params){console.log('params'+params);var _data2=_data;_data2.page=params.page;$.ajax({url:ajaxUrl,type:'POST',data:_data2,dataType:'json',success:function(response,status,xhr){console.log("xhr"+xhr);var listObj2={wayObj:response}
listObj2.wayObj.isme=_isme;var strHtml2=template('T_wayList',listObj2);console.log(strHtml2);_tbody.html(strHtml2);params.callback(response);},error:function(){console.log("error");}})}});if(_type==2&&count==0){console.log('sthi');$('.pagination').eq(0).show();count++;}else{$('.pagination').eq(_type-1).show();}
console.log(count);}},error:function(xhr){console.log('error');}});}})