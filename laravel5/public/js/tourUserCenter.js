var nikeError=void(0);var signError=void(0);var isValidNikeName=false;var isSubmit=false;var originNikeName='',originSign='';var num=1;var provinceSelector,citySelector;$(function(){tucTrip.init();});var tucTrip={init:function(){tucTrip.editUser();},allSet:function(){var _val=$.trim($(".doyen-list-u-n > a").html());var _parent=$('input[name="tucNick"]').parent('div.tuc1-eu');if(!_val||_val=='亲爱的会员'){_parent.find('span.tuc1-etips').show();}else{_parent.find('span.tuc1-etips').hide();_parent.find('input[name="tucNick"]').val(_val)}
_parent.find('span.tuc1-error').remove();_parent.find('p.tuc1-error').remove();var _valT=$.trim($(".doyen-list-user").find('p.doyen-list-u-s').eq(0).html());var _parentT=$('.tuc1-textarea').parent('div.tuc1-etext');if(!_valT||_valT==null){_parentT.find('span.tuc1-etips').show();}else{_parentT.find('span.tuc1-etips').hide();}
_parentT.find('span.tuc1-error').remove();},editUser:function(){tucTrip.allSet();originNikeName=$.trim($(".doyen-list-u-n > a").html());originSign=$.trim($(".tuc1-etext > .tuc1-textarea").val())
$('.doyen-list-u-url > span.doyen-url-eidt').off().on('click',function(){$.layer({type:1,title:['','background:none;height:0;border:none;'],border:[0],closeBtn:[0,true],btns:1,btn:['保 存'],area:['412px','278px'],page:{dom:'#tuc1'},success:function(layero){tucTrip.linkAge();tucTrip.initNick();tucTrip.editNick();tucTrip.editSign();$(layero).find('.tuc1-select').hide();$(layero).find('p.tuc1-error').remove();},yes:function(index){num=1;tucTrip.editSubmit();},close:function(){num=1;$('.tuc1-input').val(originNikeName);$('.tuc1-textarea').val(originSign)}});})},initNick:function(){$(document).on('focus','.tuc1-textarea',function(){var Val=$(this).val();if(Val=="“做人要有个性，赶紧来一段自我介绍”"){$(this).val('')}})},editNick:function(){$('.tuc1-eu > span,.tuc1-eu > input').on({'click':function(){var _this=$(this);var _parent=_this.parent('div.tuc1-eu');_parent.find('span.tuc1-etips').hide();_parent.find('input[name="tucNick"]').focus();}});$(document).on('change','input[name="tucNick"]',function(){var _this=$(this);var _parent=_this.parent('div.tuc1-eu');var _inputVal=_parent.find('input[name="tucNick"]').val();if(_inputVal==originNikeName){return;}
if(!_inputVal||_inputVal=='亲爱的会员'){_parent.find('span.tuc1-etips').show();_this.val('');nikeError=true;return false;}else{_parent.find('span.tuc1-etips').hide();var _reg="(^[\\u4e00-\\u9fa5]{2,5}$)|(^[a-zA-z]{4,10}$)|(^[\\u4e00-\\u9fa5]{1,4}[a-zA-Z]{2,8}$)";if(new RegExp(_reg).test(_inputVal)){var url="/main.php?do=user_reg_check_name&nickname="+encodeURI(_inputVal)+"&flag=nickname&cache="+Math.random();isValidNikeName=true;$.get(url,function(result){if(result=='2'){_parent.find('p.tuc1-error').remove();_parent.append('<p class="tuc1-error">该昵称已被抢注，赶紧换一个吧！</p>');nikeError=true;}
else{nikeError=false;_parent.find('p.tuc1-error').remove();}
isValidNikeName=false;if(isSubmit){tucTrip.save();isSubmit=false;}});}else{_parent.find('p.tuc1-error').remove();_parent.append('<p class="tuc1-error">必须是4-10个字符的英文或是2-5个字符的中文</p>');nikeError=true;return false;}}})},editSign:function(){$('.tuc1-textarea').on({'blur':function(){var _this=$(this);var _parent=_this.parent('div.tuc1-etext');var val=$.trim(_this.val());_parent.find('p.tuc1-error').remove();var len=val.replace(/[^\x00-\xff]/g,"01").length;if(len>40){_parent.append('<p class="tuc1-error">已超过40个字符的上限，请重新填写!</p>');signError=true;}else{signError=false;}},'click':function(){var _this=$(this);var _parent=_this.parent('div.tuc1-etext');_parent.find('span.tuc1-etips').hide();_parent.find('p.tuc1-error').remove();},'keyup':function(){var _this=$(this);var _parent=_this.parent('div.tuc1-etext');var val=$.trim(_this.val());_parent.find('p.tuc1-error').remove();var len=val.replace(/[^\x00-\xff]/g,"01").length;if(len>40){_parent.append('<p class="tuc1-error">已超过40个字符的上限!</p>');signError=true;}else{signError=false;}}})},linkAge:function(){var eleProvince=$('#province');var eleCity=$('#city');var codeProvince=$('#J_City').data('province');var codeCity=$('#J_City').data('city');if(!provinceSelector){var s1=new Select('#province',{showBlank:false,blankLabel:'请选择',defaultOption:codeProvince,onchange:function(key){if(key=='0'){return;}
eleProvince.attr('data-value',key);$.get('/yii.php?r=person/personpage/ajaxGetDistrict',{key:key},function(data){s2.load(data,num);num++;},'json');}});provinceSelector=s1;}
if(!citySelector){var s2=new Select('#city',{showBlank:false,blankLabel:'请选择',defaultOption:codeCity,onchange:function(key){if(key=='0'){return;}
eleCity.attr('data-value',key)}});citySelector=s2;}
$.get('/yii.php?r=person/personpage/ajaxGetDistrict',{key:40002},function(data){s1.load(data);},'json');},editSubmit:function(){if(isValidNikeName){isSubmit=true;}else{tucTrip.save();}},save:function(){if(!nikeError&&!signError){var nickname=$('.tuc1-eu > span,.tuc1-eu > input').val();var mood=$('.tuc1-textarea').val();var provinceId=$('#province').attr('data-value');var cityId=$('#city').attr('data-value');$.post('/yii.php?r=person/personpage/ajaxSaveUserInfo',{nickname:nickname,mood:mood,proCode:provinceId,cityCode:cityId},function(data){window.location.reload();},'json');}else{return false;}}}