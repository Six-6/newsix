;$(function(){var province,country,flag,group;var addCspot={province:{},init:function(){addCspot.siteMsg();addCspot.addGroomSpot();addCspot.delMyGroom();addCspot.editGroom();addCspot.addMyRoute();addCspot.delMyRoute();addCspot.weixinPopUp();var sumObj=addCspot.spotNum();if((sumObj.c+sumObj.f)>=4){$('.tuc-track div.tuc-area-more').show();}},addPopUp:function(){$('.tuc-content').on('click','.tuc-content-title > a.addtrack',function(){$.layer({type:1,title:['新增足迹','background:#5fb859;height:25px;line-height:25px;border:none;color:#fff;border-radius:5px 5px 0 0;'],border:[0],closeBtn:[1,true],btns:1,btn:['添 加'],area:['450px','240px'],page:{dom:'#tuc2'},success:function(layero){$(layero).find('div.popup-error').hide();addCspot.setArea(layero,'hasselected');},yes:function(index){var obj=addCspot.getCity('cityShow');var res='';for(var k in obj){res=k;}
if(k){addCspot.cerPopUp();}else{$('div.popup-error').show();}}});});},cerPopUp:function(){$.layer({type:1,title:['友情提示','background:#5fb859;height:25px;line-height:25px;border:none;color:#fff;border-radius:5px 5px 0 0;'],border:[0],closeBtn:[1,true],btns:2,btn:['确 认','取 消'],area:['253px','132px'],page:{dom:'#tuc3'},success:function(){},yes:function(index){var obj=addCspot.getCity('cityShow');var csrf_token=$('#csrf_token').html();$.post("/yii.php?r=person/personpage/ajaxAddFootprint",{"is_china":parseInt(-(flag-2)),"obj":obj,"csrf_token":csrf_token},function(data){if(data.csrf_token!=''){$('#csrf_token').html(data.csrf_token);}
addCspot.turArea(obj,flag);layer.closeAll();},'json');},no:function(index){layer.close(index);}});},delPopUp:function(){var _html='<p class="changename">确定删除此条足迹吗？</p>';var _url='http://172.30.24.80/tourUserCenter/area.php';$('.tuc-track-right').on('click','.area-list-name > span.colse',function(){var _parent=$(this).parents('div.area-list');var _parentId=_parent.attr('id');var _data=_parent.data('code');var csrf_token=$('#csrf_token').val();$.layer({type:1,title:['友情提示','background:#5fb859;height:25px;line-height:25px;border:none;color:#fff;border-radius:5px 5px 0 0;'],border:[0],closeBtn:[1,true],btns:2,btn:['确 认','取 消'],area:['253px','132px'],page:{html:_html},success:function(){},yes:function(index){$.post(_url,{data:_data,csrf_token:'csrf_token'},function(response){if(response.csrf_token!=''){$('#csrf_token').val(response.csrf_token);}
$('#'+_parentId).remove();},'json');layer.close(index);},no:function(index){layer.close(index);}});})},linkAge:function(){var _areaObj={};$('p.area-name').each(function(){var _k=$(this).data('value');var _v=$(this).html();_areaObj[_k]=_v;});var s1=new Select('#cprovince',{showBlank:true,blankLabel:'请选择',selectFirst:false,onchange:function(key,value){var res={};res[key]=value;province=res;flag=1;if(key=='0'){return;}
for(var j in _areaObj){if(key===j){return}}
$.get('/yii.php?r=person/personpage/ajaxGetDistrict',{key:key},function(data){var _html='';for(var k in data){_html+='<span data-code="'+k+'">'+data[k]+'</span>'}
$('#cityShow').html(_html);addCspot.cityList('cityShow','hasselected');},'json');}});s1.load({100:'安徽',400:'福建',500:'甘肃',600:'广东',700:'广西',800:'贵州',900:'海南',1000:'河北',1100:'黑龙江',1200:'河南',1300:'香港',1400:'湖北',1500:'湖南',1600:'江苏',1700:'江西',1800:'吉林',1900:'辽宁',2000:'澳门',2100:'内蒙古',2200:'宁夏',2300:'青海',2400:'山东',2600:'山西',2700:'陕西',2800:'四川',2900:'台湾',3000:'天津',3100:'新疆',3200:'西藏',3300:'云南',3400:'浙江',200:'北京',2500:'上海',300:'重庆'});var f1=new Select('#fprovince',{showBlank:true,blankLabel:'请选择',selectFirst:false,onchange:function(key,value){var res={};res[key]=value;country=res;flag=2;if(key=='0'){return;}
$.get('/yii.php?r=person/personpage/ajaxGetDistrict',{key:key},function(data){var _html='';for(var k in data){_html+='<span data-code="'+k+'">'+data[k]+'</span>'}
$('#cityShow').html(_html);addCspot.cityList('cityShow','hasselected');},'json');}});f1.load({3900:'亚洲',3600:'欧洲',4000:'非洲',4100:'大洋洲',3700:'北美洲',3800:'南美洲'});},cityList:function(_id,_class,mtl){if(!mtl){var n=0;$('#'+_id+' > span').each(function(){if(this.className.indexOf('taseclet')>-1){n++;}});$('.'+_class).find('span:eq(0)').html(n);$('#'+_id+' > span').each(function(){$(this).off().on('click',function(){$('div.popup-error').hide();if(this.className.indexOf('taseclet')>-1){$(this).removeClass('taseclet');n>1?n--:n=0;}else{$(this).addClass('taseclet');n+=1;}
$('.'+_class).find('span').html(n);});});}else{$('#'+_id+' > span').off().on('click',function(){$('#'+_id+' > span').removeClass('taseclet');$(this).addClass('taseclet');var _val=$(this).html();if(mtl=='1'){group=_val;$('div.place-input').html(_val);}else if(mtl=='2'){$('div.place-input').html(group+' '+_val);}});}},getCity:function(_id){var _obj={};$('#'+_id+' > span').each(function(){var _this=$(this);var _key=_this.data('code');var _value=_this.html();if(this.className.indexOf('taseclet')>-1){_obj[_key]=_value;}});return _obj;},turArea:function(data,sign){var _num='0';var _comments='0';var _htmltile='',_html='',nav='',id='';if(sign=='1'){if(data){for(var j in province){id='chinaAll'+j;_htmltile+='<div class="china-all" id="chinaAll'+j+'">'
+'<div class="tuc-area-province"><i></i><span data-value="'+j+'" id="china'+j+'">'+province[j]+'</span>'
+'<p class="area-del tuc-icon" data-code="chinaAll'+j+'"></p></div>';nav+='<a class="track-city" data-value="'+j+'" href="#china'+j+'">'+province[j]+'</a>';}
for(var k in data){_html+='<div class="tuc-area-title">'
+' <img class="area-icon tuc-icon"  src="http://img2.tuniucdn.com/site/file/deyon/images/transparent.gif"/>'
+'<div class="area-details">'
+'<p class="area-name"  id ="china'+k+'" data-value="'+k+'">'+data[k]+'</p>'
+'</div>'
+'<div class="area-details">'
+'<p class="J-SumComment area-details-left"><em class="J-CountSpot">'+_num+'</span>个景点,<em class="J-CountComment">'+_comments+'</span>条点评</p>'
+'<a class="area-details-right tuc-icon" href="javascript:;" data-value="china'+k+'">继续添加景点</a>'
+'</div>'
+'</div>';}
if($('#chinaEare').find('div#'+id).length>0){$('#'+id+' div.tuc-area-province').after(_html);}else{$('.tuc-track-nav').find('a.track-home').after(nav);$('#chinaEare > p.tuc-track-title').after(_htmltile+_html);}}}else if(sign=='2'){if(data){_html='';for(var k in data){_html+='<div class="foreign-all" id="foreignAll'+k+'">'
+'<div class="tuc-area-title">'
+' <img class="area-icon tuc-icon"  src="http://img2.tuniucdn.com/site/file/deyon/images/transparent.gif"/>'
+'<div class="area-details">'
+'<p class="area-name" data-value="'+k+'" id="foreign'+k+'">'+data[k]+'</p>'
+'<p class="area-del tuc-icon" data-code="foreignAll'+k+'"></p>'
+'</div>'
+'<div class="area-details">'
+'<p class="J-SumComment area-details-left"><em class="J-CountSpot">'+_num+'</em>个景点,<em class="J-CountComment">'+_comments+'</em>条点评</p>'
+'<a class="area-details-right tuc-icon" href="javascript:;" data-value="foreign'+k+'">继续添加景点</a>'
+'</div>'
+'</div>'
+'</div>';nav+='<a class="track-city" data-value="'+k+'" href="#foreign'+k+'">'+data[k]+'</a>';}
$('.tuc-track-nav').find('a.track-foreign').after(nav);$('#foreignEare > p.tuc-track-title').after(_html);}}},setArea:function(dom,tag){$(dom).find('div.tuc1-addforg > div').hide();$(dom).find('div.tuc1-add > div').show();$(dom).find('.tuc1-add > label').css('color','#666');$(dom).find('div.tuc1-addforg > label').on('click',function(){$(dom).find('#placeShow').html('请选择一个地方');$(dom).find('div.place-input').html('');$(dom).find('div.tuc1-spotp').hide();$(dom).find('label').css('color','#999');$(this).css('color','#666');$(dom).find('div.tuc1-add > div').hide();$(dom).find('div.tuc1-addforg > div').show();$('div.popup-error').hide();$(dom).find('div#cityShow').html('请选择一个地方');$('div.tuc1-label').html('请选择');});$(dom).find('div.tuc1-add > label').on('click',function(){$(dom).find('#placeShow').html('请选择一个地方');$(dom).find('div.place-input').html('');$(dom).find('div.tuc1-spotp').hide();$(dom).find('label').css('color','#999');$(this).css('color','#666');$(dom).find('div.tuc1-addforg > div').hide();$(dom).find('div.tuc1-add > div').show();$('div.popup-error').hide();$(dom).find('div#cityShow').html('请选择一个地方');$('div.tuc1-label').html('请选择');});},localSearch:function(id){$('.J-AddSearchBtn').on('click',function(){var _val=$('.J-AddSearchInput').val();var url='/yii.php?r=person/ajax/searchSpotById';var code1=parseInt($('#placeShow  span.taseclet').data('code'));var f=true;if(_val==''||_val==null){f=false;}
$.get(url,{key:code1,k:_val},function(data){var search_recommend_spot_html='';for(var k in data){search_recommend_spot_html+='<span data-code="'+data[k].id+'">'+data[k].name+'</span>'}
$('#'+id).html(search_recommend_spot_html);addCspot.cityList(id,'taseclet','2');addCspot.scrollLoad(id,code1);},'json');})},scrollLoad:function(id,key){var nScrollHight=0;var nScrollTop=0;var nDivHight=$("#"+id).height();var finished=true;var url='/yii.php?r=person/ajax/getSpotById';var times=1;$('#'+id).scroll(function(e){nScrollHight=$(this)[0].scrollHeight;nScrollTop=$(this)[0].scrollTop;if(finished&&parseInt(nScrollTop+nDivHight+13)>=nScrollHight&&times>=0){var span='';var num=0;finished=false;$.ajax({type:"GET",url:url,data:{key:key,times:times,mark:2},dataType:'json',beforeSend:function(){},success:function(data){for(var k in data){span+='<span data-code="'+data[k].id+'">'+data[k].name+'</span>';num++;}
$('#'+id).append(span);addCspot.cityList(id,'taseclet','2');if(num<30){times=-1;}else{times++;}
finished=true;}})}})},spotNum:function(){var sum={};var sumChina=0,sumForeign=0;$('#chinaEare  div.area-list').each(function(){sumChina+=1;});$('#foreignEare  div.area-list').each(function(){sumForeign+=1;});sum.c=sumChina;sum.f=sumForeign;return sum;},moveInDel:function(){$('.tuc-track').on({'mouseenter':function(){$(this).css('background','#d2d2d2');$(this).find('p.area-del').show();},'mouseleave':function(){$(this).css('background','#EFEFEF');$(this).find('p.area-del').hide();}},'div.china-all,div.foreign-all');var _html='<p class="changetips">删除城市将会同时删除下面的足迹，确认删除么？</p>';var _url='http://172.30.24.80/tourUserCenter/area.php';var _data='省+景点/国家+景点';$('.tuc-track').on('click','p.area-del',function(){var _code=$(this).data('code');$.layer({type:1,title:['友情提示','background:#5fb859;height:25px;line-height:25px;border:none;color:#fff;border-radius:5px 5px 0 0;'],border:[0],closeBtn:[1,true],btns:2,btn:['确 认','取 消'],area:['253px','132px'],page:{html:_html},success:function(){},yes:function(index){$.get(_url,{data:_data},function(){$('#'+_code).remove();$('.tuc-track div.tuc-track-nav > a.track-city').each(function(){var _value=$(this).data('value');if(('chinaAll'+_value)==_code||('foreignAll'+_value)==_code){$(this).remove();}});},'json');layer.close(index);},no:function(index){layer.close(index);}});});},siteMsg:function(){$('#tucDoyen div.tuc-groom-list-pic ').each(function(){$(this).on({'mouseenter':function(){},'mouseleave':function(){}});});},addGroomSpot:function(){$('#tucRemmmond').on('click','p.tuc-content-title > a.add,#tucNowRem',function(){$('div.place-show').hide();$('div.place-input').html('');$('place-textarea').val('');var _areaObj={};$('p.area-name').each(function(){var _k=$(this).data('value');var _v=$(this).html();_areaObj[_k]=_v;});$.layer({type:1,title:['选择推荐景点','background:#5fb859;height:25px;line-height:25px;border:none;color:#fff;border-radius:5px 5px 0 0;'],border:[0],closeBtn:[1,true],offset:['50px',''],btns:1,btn:['确定推荐'],area:['460px','305px'],move:false,fix:false,page:{dom:'#tuc6'},success:function(layero){var index=layer.index;var s1=new Select('#cplace',{showBlank:false,selectFirst:false,onchange:function(key,value){var res={};res[key]=value;province=res;if(key=='0'){return;}
for(var j in _areaObj){if(key===j){return}}
var url='/yii.php?r=person/personpage/ajaxGetDistrict&usage_type=recommend';$.get(url,{key:key},function(data){var _html='';for(var k in data){_html+='<span data-code="'+k+'">'+data[k]+'</span>'}
$('#placeShow').html(_html);addCspot.cityList('placeShow','hasselected','1');},'json');}});s1.load({100:'安徽',400:'福建',500:'甘肃',600:'广东',700:'广西',800:'贵州',900:'海南',1000:'河北',1100:'黑龙江',1200:'河南',1300:'香港',1400:'湖北',1500:'湖南',1600:'江苏',1700:'江西',1800:'吉林',1900:'辽宁',2002:'澳门',2100:'内蒙古',2200:'宁夏',2300:'青海',2400:'山东',2600:'山西',2700:'陕西',2800:'四川',2900:'台湾',3000:'天津',3100:'新疆',3200:'西藏',3300:'云南',3400:'浙江',200:'北京',2500:'上海',300:'重庆'});var f1=new Select('#fplace',{showBlank:false,selectFirst:false,onchange:function(key,value){var res={};res[key]=value;country=res;if(key=='0'){return;}
var url='/yii.php?r=person/personpage/ajaxGetDistrict&usage_type=recommend';$.get(url,{key:key},function(data){var _html='';for(var k in data){_html+='<span data-code="'+k+'">'+data[k]+'</span>'}
$('#placeShow').html(_html);addCspot.cityList('placeShow','hasselected','1');},'json');}});f1.load({3900:'亚洲',3600:'欧洲',4000:'非洲',4100:'大洋洲',3700:'北美洲',3800:'南美洲'});$('div.tuc1-label').html('请选择');$(layero).find('span.tuc-icon').removeClass('starl').addClass('starb');$(layero).on('click','p.place-title .add',function(){layer.area(index,{height:'375px'});$(layero).find('div.place-input').show();$(layero).find('div.tuc-nom-nominate').css('marginTop','20px');$(layero).find('div.place-show').show();$(layero).find('#placeShow').html('请选择一个地方');addCspot.setArea(layero);addCspot.showByStep(layero,index,'1');addCspot.localSearch('Spotplace');addCspot.cityList('Spotplace','hasselected','2');});$(layero).on('click','#placeShow > span ',function(){var key=$(this).data('code');var url='/yii.php?r=person/ajax/getSpotById';$.get(url,{key:key,type:'spot'},function(data){var _html='';for(var k in data){_html+='<span data-code="'+data[k].id+'">'+data[k].name+'</span>'}
$('#Spotplace').html(_html);addCspot.cityList('Spotplace','hasselected','2');addCspot.showByStep(layero,index,'2');addCspot.scrollLoad('Spotplace',key);},'json');});$(layero).on('click','.tuc-nom-nominate > p.area-list-star > span',function(){var _index=$(this).index();$('.tuc-nom-nominate > p.area-list-star > span',$(layero)).removeClass('starl').addClass('starb');for(var k=0;k<=_index;k++){$('.tuc-nom-nominate > p.area-list-star').find('span').eq(k).removeClass('starb').addClass('starl');}
$('p.area-list-star',$(layero)).attr('data-star',_index);});},yes:function(index){var _text=$('#tuc6  .place-textarea').val();var _city=$('#tuc6  div.place-input').html();var star=parseInt($('#tuc6  p.area-list-star').data('star'));var code1=parseInt($('#placeShow  span.taseclet').data('code'));var code2=parseInt($('#Spotplace  span.taseclet').data('code'));var _starl='',_starb='';var _url='/person/addRecommend/';if(!_city||!code1||!code2){return}
if(_text.length>800){$('#tuc6 > div.tuc5-error').show();}else{for(var i=0;i<star+1;i++){_starl+=' <span class="starl tuc-icon"></span>';}
for(var i=0;i<(4-star);i++){_starb+=' <span class="starb tuc-icon"></span>';}
$.post(_url,{'data':_text,'num':star,city:_city,code1:code1,code2:code2},function(data){if(data){$('#tucRemmmond').html('');$('#tucRemmmond').html(data);addCspot.controlWordFirst();}else{alert('添加失败！');}},'html');layer.close(index);}
$('div.place-show').hide();$('div.tuc1-spotp').hide();$('.J-AddSearchInput').val('');$('div.tuc1-label').remove();$('div.tuc1-areashow > span').removeClass('taseclet');$('div.tuc1-areashow').empty().hide();$('div.place-input').html('');$('div.place-reason > .place-textarea').val('');$('.tuc-nom-nominate > p.area-list-star > span').removeClass('starl').addClass('starb');$('#tuc6 div.tuc-nom-nominate').css('marginTop','0');},close:function(){$('div.place-show').hide();$('div.tuc1-spotp').hide();$('.J-AddSearchInput').val('');$('div.tuc1-areashow > span').removeClass('taseclet');$('div.tuc1-label').remove();$('div.tuc1-areashow').empty().hide();$('div.place-input').html('');$('.tuc-nom-nominate > p.area-list-star > span').removeClass('starl').addClass('starb');$('div.place-reason > .place-textarea').val('');$('#tuc6 div.tuc-nom-nominate').css('marginTop','0');}});});},delMyGroom:function(){var _html='<p class="changename">确定删除此条推荐吗？</p>';var _url='/yii.php?r=person/ajax/delVSpot';var csrf_token=$('#csrf_token').html();$('#tucRemmmond').on('click','p.tuc-nom-edit > span.del',function(){var _parent=$(this).parents('div.tuc-nom-tag').parent('div');var _parentId=_parent.attr('id');var _data=_parent.data('code');$.layer({type:1,title:['友情提示','background:#5fb859;height:25px;line-height:25px;border:none;color:#fff;border-radius:5px 5px 0 0;'],border:[0],closeBtn:[1,true],btns:2,btn:['确 认','取 消'],area:['253px','132px'],page:{html:_html},success:function(){},yes:function(index){$.post(_url,{del_id:_data,mark:2,csrf_token:csrf_token},function(data){$('#tucRemmmond').html('');$('#tucRemmmond').html(data);addCspot.controlWordFirst();},'html');layer.close(index);},no:function(index){layer.close(index);}});})},showByStep:function(dom,index,tag){if(tag=='1'){$(dom).find('div.tuc1-areashow').show();layer.area(index,{height:'505px'});}else{$(dom).find('div.tuc1-spotp').show();layer.area(index,{height:'660px'});}},editGroom:function(){$('#tucRemmmond').on('click','p.tuc-nom-edit > span.edit',function(){var _this=$(this);var _code=_this.data('code');var _title=$('#groom'+_code).find('p.tuc-nom-title').find('a:eq(0)').html();var _star=$('#groom'+_code).find('p.tuc-nom-star').attr('data-star');var _text=$('#groom'+_code).find('p.tuc-nom-reason').find('span:eq(1)').attr('data-name');$.layer({type:1,title:['友情提示','background:#5fb859;height:25px;line-height:25px;border:none;color:#fff;border-radius:5px 5px 0 0;'],border:[0],closeBtn:[1,true],btns:1,btn:['确 定'],area:['460px','350px'],page:{dom:'#tuc7'},success:function(layero){$('p.area-list-star',$(layero)).attr('data-star',_star);$(layero).find('p.area-list-star').find('span').removeClass('starl').addClass('starb');$(layero).find('div.place-input').html(_title);for(var i=0;i<=_star;i++){$(layero).find('p.area-list-star').find('span').eq(i).removeClass('starb').addClass('starl');}
$(layero).find('div.place-reason > .place-textarea').val(_text);$(layero).on('click','.tuc-nom-nominate > p.area-list-star > span',function(){var _index=$(this).index();$('.tuc-nom-nominate > p.area-list-star > span',$(layero)).removeClass('starl').addClass('starb');for(var k=0;k<=_index;k++){$('.tuc-nom-nominate > p.area-list-star',$(layero)).find('span').eq(k).removeClass('starb').addClass('starl');}
$('p.area-list-star',$(layero)).attr('data-star',_index);});},yes:function(index){var url='/yii.php?r=person/ajax/updateRecommend';var _data=_code;var editStar=$('#tuc7 >div.tuc-nom-nominate > p.area-list-star').attr('data-star');var editText=$('#tuc7 >div.place-reason > .place-textarea').val();$.post(url,{'code':_data,num:editStar,data:editText},function(){$('#groom'+_code).find('p.tuc-nom-star ').attr('data-star',editStar);$('#groom'+_code+' p.tuc-nom-star ').find('span').removeClass().addClass('starb tuc-icon');for(var i=0;i<=editStar;i++){$('#groom'+_code+' p.tuc-nom-star').find('span').eq(i).removeClass('starb').addClass('starl');}
var _t=addCspot.controlWord(_this,editText);$('#groom'+_code).find('p.tuc-nom-reason').find('span:eq(1)').data('name',editText);$('#groom'+_code).find('p.tuc-nom-reason').find('span:eq(1)').html(_t);layer.close(index);});},close:function(){$('#tuc7 div.place-input').html('');$('#tuc7 .tuc-nom-nominate > p.area-list-star > span').removeClass('starl').addClass('starb');$('#tuc7 div.place-reason > .place-textarea').val('');}})})},controlWordFirst:function(){var ele=$('.J-ReasonPop');var eleVal;var len;ele.each(function(){eleVal=$.trim($(this).attr('data-name'));if(eleVal==null)return 0;if(typeof eleVal!="string"){eleVal+="";}
len=eleVal.replace(/[^\x00-\xff]/g,"01").length;if(len>20){eleVal=addCspot.sliceWord(eleVal,16)+'...';}
$(this).html(eleVal)})},controlWord:function(self,word){var eleVal=word;var len;if(eleVal==null)return 0;if(typeof eleVal!="string"){eleVal+="";}
len=eleVal.replace(/[^\x00-\xff]/g,"01").length;if(len>20){eleVal=addCspot.sliceWord(eleVal,16)+'...';}
return eleVal;},sliceWord:function(s,n){return s.slice(0,n).replace(/([^x00-xff])/g,"$1a").slice(0,n).replace(/([^x00-xff])a/g,"$1");},addMyRoute:function(){var url='/yii.php?r=person/ajax/getRecommendRouteInfo';var _type='1';$('#remRoute').on('click','p.tuc-content-title > a.add,.edit,#remToFriend',function(){var _this=$(this);var filter_flag=0;var _data=_this.data('code');var phtml='',ptitle='',chtml='',ctitle='';var getData={};$.layer({type:1,title:['','background:none;height:0'],border:[0],closeBtn:[0,true],btns:1,btn:['现在就推荐'],area:['660px','545px'],page:{dom:'#tuc8'},success:function(layero){if(_this.hasClass('add')){filter_flag=1;}else{$(layero).find('h4:eq(0)').show();$(layero).find('span.xubox_botton').show();}
$.get(url,{'type':_type,'filter_flag':filter_flag},function(data){if(data['product']&&data['product']['list'].length>0){ptitle+='<div class="tuc-buied">'
+'<div class="tuc-buied-title">'
+'<p class="tuc-buied-t-l">'+data['product']['title']+'</p>'
+'<p class="tuc-buied-t-r">给你推荐的线路打个标签吧</p>'
+'</div>'
+'<div class="tuc-product">';for(var k in data['product']['list']){phtml+='<div class="tuc-route-list" id="p'+data['product']['list'][k].id+'" data-code="'+data['product']['list'][k].id+'">'
+'<div class="tuc-r-l-select tuc-icon"></div>'
+'<div class="tuc-r-l-product">'
+'<div class="tuc-product-img">'
+'<a href="'+data['product']['list'][k].url+'" target="_blank" title="'+data['product']['list'][k].name+'"><img width="70" height="70" alt="xx" src="'+data['product']['list'][k].img+'"/></a>'
+'</div>'
+'<div class="tuc-product-details">'
+'<p><a href="'+data['product']['list'][k].url+'" target="_blank" title="'+data['product']['list'][k].name+'">'+data['product']['list'][k].nameAb+'</a> </p>'
+'<p>产品ID：'+data['product']['list'][k].id+'</p>'
+'<p>途牛价：￥<span>'+data['product']['list'][k].price+'</span></p>'
+'</div>'
+'</div>'
+'<div class="tuc-r-l-tag">';for(var p in data['product']['list'][k].tag){if(data['product']['list'][k].tag[p].pag){phtml+='<span class="pag-select">'+data['product']['list'][k].tag[p].text+'</span>';}else{phtml+='<span>'+data['product']['list'][k].tag[p].text+'</span>';}}
phtml+='</div>'
+'</div>';}}
if(data['collect']&&data['collect']['list'].length>0){ctitle+='<div class="tuc-buied">'
+'<div class="tuc-buied-title">'
+'<p class="tuc-buied-t-l">'+data['collect']['title']+'</p>'
+'<p class="tuc-buied-t-r">给你推荐的线路打个标签吧</p>'
+'</div>'
+'<div class="tuc-product">';for(var j in data['collect']['list']){chtml+='<div class="tuc-route-list" id="c'+data['collect']['list'][j].id+'" data-code="'+data['collect']['list'][j].id+'">'
+'<div class="tuc-r-l-select tuc-icon"></div>'
+'<div class="tuc-r-l-product">'
+'<div class="tuc-product-img">'
+'<a href="'+data['collect']['list'][j].url+'" target="_blank" title="'+data['collect']['list'][j].name+'"><img width="70" height="70" alt="xx" src="'+data['collect']['list'][j].img+'"/></a>'
+'</div>'
+'<div class="tuc-product-details">'
+'<p><a href="'+data['collect']['list'][j].url+'" target="_blank" title="'+data['collect']['list'][j].name+'">'+data['collect']['list'][j].nameAb+'</a> </p>'
+'<p>产品ID：<em>'+data['collect']['list'][j].id+'</em></p>'
+'<p>途牛价：￥<span>'+data['collect']['list'][j].price+'</span></p>'
+'</div>'
+'</div>'
+'<div class="tuc-r-l-tag">';for(var g in data['collect']['list'][j].tag){if(data['collect']['list'][j].tag[g].pag){chtml+='<span class="pag-select">'+data['collect']['list'][j].tag[g].text+'</span>';}else{chtml+='<span>'+data['collect']['list'][j].tag[g].text+'</span>';}}
chtml+='</div>'
+'</div>';}}
if(data['product']['list'].length<=0&&data['collect']['list'].length<=0){$(layero).find('h4:eq(0)').hide();$(layero).find('span.xubox_botton').hide();chtml+='<div class="mytuijian">'
+'<img src="http://img2.tuniucdn.com/site/file/deyonUserCenter/images/empty.png" width="104" height="103" /<div >'
+'<p>亲，你是热心达人，把自己珍藏或体验过的线路都推荐给小伙伴啦，再去<a href="http://www.tuniu.com/" target="_blank">挖掘新的线路吧~</a></p></div>';}
$(layero).find('h4:eq(0)').after(ctitle+chtml);$(layero).find('h4:eq(0)').after(ptitle+phtml);$(layero).on('click','div.tuc-route-list > div.tuc-r-l-select',function(){if(this.className.indexOf('route-select')>-1){$(this).removeClass('route-select');}else{$(this).addClass('route-select');}});$(layero).on('click','div.tuc-route-list > div.tuc-r-l-tag > span',function(){if(this.className.indexOf('pag-select')>-1){$(this).removeClass('pag-select');}else{$(this).addClass('pag-select');}});var list=0;$('#tuc8').on('click','div.tuc-r-l-select',function(){var _parentId=$(this).parent('div.tuc-route-list').attr('id');getData[list]=_parentId;list++;});},'json');},yes:function(index){var pag;var sendData=[];if($('#tuc8').find('.route-select').length<=0){$('#tuc8').find('div.product-error').show();}else{for(var i in getData){pag=[];$('#'+getData[i]+' div.tuc-r-l-tag').find('span').each(function(k){if($(this).hasClass('pag-select')){pag[k]=true;}else{pag[k]=false;}});sendData[i]={id:getData[i].substr(1),tag:pag}}
var last=JSON.stringify(sendData);var addurl='/yii.php?r=person/ajax/addRecommendRoute';$.post(addurl,{json:last},function(data){$.remtucRoute(data);$('#tuc8').find('div.product-error').hide();$('#tuc8').find('div.tuc-buied').remove();layer.close(index);},'json');}},close:function(index){$('#tuc8').find('div.tuc-buied').remove();$('#tuc8').find('div.mytuijian').remove();}})});},delMyRoute:function(){var _html='<p class="changename">确定删除此条推荐吗？</p>';var _url='/yii.php?r=person/ajax/delRoute';$('#remRoute').on('click','p.tuc-route-edit > span.del',function(){var _data=$(this).data('code');$.layer({type:1,title:['友情提示','background:#5fb859;height:25px;line-height:25px;border:none;color:#fff;border-radius:5px 5px 0 0;'],border:[0],closeBtn:[1,true],btns:2,btn:['确 认','取 消'],area:['253px','132px'],page:{html:_html},success:function(){},yes:function(index){$.post(_url,{data:_data},function(data){$.remtucRoute(data);layer.close(index);},'json');},no:function(index){layer.close(index);}});})},weixinPopUp:function(){$('.bdsharebuttonbox').on('click','.aaa_weixin',function(){$.layer({type:1,title:['','background:none;height:0'],shade:[0.5,'#000'],border:[10,0.3,'#000'],closeBtn:[0,true],shadeClose:true,btns:0,btn:[''],area:['788px','417px'],page:{dom:'#tuc9'},success:function(layero){$(layero).find('.xubox_setwin').css('top','12px');}});});}}
window['addCspot']=addCspot;addCspot.init();});